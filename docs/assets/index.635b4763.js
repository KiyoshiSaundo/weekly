import{o as c,c as u,a as l,A as $,w as v,v as k,t as h,r as m,b as g,F as y,d as S,e as E,f as b,g as f,n as x,h as A,i as U}from"./vendor.c5d43746.js";const C=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const e of o)if(e.type==="childList")for(const n of e.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function a(o){const e={};return o.integrity&&(e.integrity=o.integrity),o.referrerpolicy&&(e.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?e.credentials="include":o.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function i(o){if(o.ep)return;o.ep=!0;const e=a(o);fetch(o.href,e)}};C();var p=(t,s)=>{const a=t.__vccOpts||t;for(const[i,o]of s)a[i]=o;return a};const O={name:"Header"},L={class:"header"},F=l("h1",{class:"header__h1"},'\u041E\u0442\u0447\u0435\u0442 "\u041D\u0435\u0434\u0435\u043B\u044C\u043A\u0430"',-1),j=[F];function N(t,s,a,i,o,e){return c(),u("header",L,j)}var w=p(O,[["render",N]]);const P={name:"Settings",data(){return{apiUrl:this.$store.state.apiUrl,userId:this.$store.state.userId,start:this.$store.state.dateFrom,end:this.$store.state.dateTo,datePickerInst:!1}},mounted(){this.datePickerInst=new $("[name=dates]",{range:!0,multipleDatesSeparator:" - ",selectedDates:[this.start,this.end],onSelect(t){t.date.length==2&&t.datepicker.hide()}})},methods:{setSettings(){this.$store.commit("apiChange",{apiUrl:this.apiUrl}),this.$store.commit("userChange",{userId:this.userId}),this.$store.commit("dateChange",{dateFrom:this.datePickerInst.selectedDates[0],dateTo:this.datePickerInst.selectedDates[1]})}}},M={class:"settings"},R={class:"settings__items"},V={class:"settings__item"},G=l("label",{class:"settings__label"},"\u0421\u0442\u0440\u043E\u043A\u0430 API",-1),H={class:"settings__item"},K=l("label",{class:"settings__label"},"ID \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",-1),z=l("div",{class:"settings__item"},[l("label",{class:"settings__label"},"\u041F\u0435\u0440\u0438\u043E\u0434"),l("input",{class:"settings__input",type:"text",name:"dates"})],-1),B={class:"settings__item"};function J(t,s,a,i,o,e){return c(),u("div",M,[l("div",R,[l("div",V,[G,v(l("input",{class:"settings__input",type:"text","onUpdate:modelValue":s[0]||(s[0]=n=>o.apiUrl=n)},null,512),[[k,o.apiUrl]])]),l("div",H,[K,v(l("input",{class:"settings__input",type:"text","onUpdate:modelValue":s[1]||(s[1]=n=>o.userId=n)},null,512),[[k,o.userId]])]),z,l("div",B,[l("button",{class:"settings__btn",onClick:s[2]||(s[2]=(...n)=>e.setSettings&&e.setSettings(...n))},"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C")])])])}var q=p(P,[["render",J]]);const D=t=>{let s,a,i;return s=t.getDate(),s<10&&(s="0"+s),a=t.getMonth()+1,a<10&&(a="0"+a),i=t.getFullYear(),s+"."+a+"."+i},T=t=>{let s,a,i;return s=Math.floor(t/3600),a=Math.floor(t/60)-s*60,i=t%60,[s.toString().padStart(2,"0"),a.toString().padStart(2,"0"),i.toString().padStart(2,"0")].join(":")},Y=async(t,s)=>fetch(t+"/task.elapseditem.getlist",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:{ID:"asc"},filter:s,select:["ID","TASK_ID","SECONDS"],params:{NAV_PARAMS:{nPageSize:0}}})}).then(a=>a.json()),Q=async(t,s)=>{const a=(n,r,d)=>fetch(n+"/tasks.task.list",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:{ID:"asc"},filter:r,select:["ID","TITLE","GROUP_ID","TIME_ESTIMATE"],start:d})}).then(_=>_.json());let i=[],o=0,e=null;for(;e===null||o<e;){let n=a(t,s,o);if(e===null){let r=await n;e=parseInt(r.total)}i.push(n),o+=50}return Promise.all(i)},W=async(t,s)=>fetch(t+"/sonet_group.get",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({ORDER:{ID:"asc"},FILTER:s})}).then(a=>a.json());const X={name:"TaskItem",props:["fields"],methods:{formatTime:T}},Z={class:"task"};function ee(t,s,a,i,o,e){return c(),u("div",Z,h(a.fields.id)+" - "+h(a.fields.name)+" ("+h(e.formatTime(a.fields.seconds))+") ",1)}var te=p(X,[["render",ee]]);const se={name:"Tasks",components:{TaskItem:te},data(){return{result:{},resultExist:!1,isLoading:!0}},computed:{settings(){return{apiUrl:this.$store.state.apiUrl,userId:this.$store.state.userId,dateFrom:this.$store.state.dateFrom,dateTo:this.$store.state.dateTo}},checkedSumm(){let t=0;for(const[s,a]of Object.entries(this.result))a.selected===!0&&(t+=a.seconds);return t},totalSumm(){let t=0;for(const[s,a]of Object.entries(this.result))t+=a.seconds;return t}},watch:{settings:{handler(){this.getData()},deep:!0}},created(){this.getData()},methods:{formatDate:D,formatTime:T,getData(){this.setLoadingStart();let t={},s={},a={},i={};if(!this.$store.state.userId||!this.$store.state.dateFrom||!this.$store.state.dateTo)return this.setLoadingEnd(),!1;let o={USER_ID:this.$store.state.userId,">=CREATED_DATE":D(this.$store.state.dateFrom),"<=CREATED_DATE":D(this.$store.state.dateTo)};Y(this.$store.state.apiUrl,o).then(e=>{if(e!=null)return e.result}).then(e=>{if(e!=null&&e.length){let n={ID:[]};return e.forEach(r=>{n.ID[n.ID.length]=r.TASK_ID,s[r.ID]={id:r.ID,taskId:r.TASK_ID,seconds:parseFloat(r.SECONDS)}}),n.ID=n.ID.filter((r,d,_)=>_.indexOf(r)===d),Q(this.$store.state.apiUrl,n)}}).then(e=>{if(e!=null){let n=[];return e.forEach(r=>{r!=null&&(n=n.concat(r.result.tasks))}),n}}).then(e=>{if(e!=null&&e.length){let n={ID:[]};return e.forEach(r=>{n.ID[n.ID.length]=r.groupId,a[r.id]={id:r.id,name:r.title,groupId:r.groupId,seconds:0}}),n.ID=n.ID.filter((r,d,_)=>_.indexOf(r)===d),W(this.$store.state.apiUrl,n)}}).then(e=>{if(e!=null)return e.result}).then(e=>{e!=null&&e.length&&e.forEach(n=>{i[n.ID]={id:n.ID,name:n.NAME,tasks:{},seconds:0,selected:this.result[n.ID]?this.result[n.ID].selected:!1}})}).then(e=>{t[0]={id:0,name:"\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u043A \u0433\u0440\u0443\u043F\u043F\u0435",tasks:{},seconds:0,selected:this.result[0]?this.result[0].selected:!1};for(const[n,r]of Object.entries(i))t[r.id]=r;for(const[n,r]of Object.entries(a)){let d=t[r.groupId]?t[r.groupId].id:0;t[d].tasks[r.id]=r,a[n].groupId=d}for(const[n,r]of Object.entries(s)){let d=a[r.taskId].groupId,_=r.taskId;t[d].seconds+=r.seconds,t[d].tasks[_].seconds+=r.seconds}Object.keys(t[0].tasks).length==0&&delete t[0],this.result=t,this.resultExist=Object.keys(t).length,this.setLoadingEnd()})},setLoadingStart(){this.$store.commit("loadingChange",{isLoading:!0})},setLoadingEnd(){this.$store.commit("loadingChange",{isLoading:!1})}}},re={class:"groups"},ne={key:1,class:"groups__items"},ae={class:"groups__label"},oe=["onUpdate:modelValue"],ie={class:"groups__tasks"},le={key:2,class:"groups__footer"},de={class:"groups__checked"},ce={class:"groups__total"},ue={key:3,class:"groups__empty"};function _e(t,s,a,i,o,e){const n=m("TaskItem");return c(),u("div",re,[o.resultExist?(c(),u("div",{key:0,class:"groups__refresh",onClick:s[0]||(s[0]=(...r)=>e.getData&&e.getData(...r))}," \u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435 ")):g("",!0),o.resultExist?(c(),u("div",ne,[(c(!0),u(y,null,S(o.result,r=>(c(),u("div",{class:"groups__item",key:r.id},[l("label",ae,[v(l("input",{class:"groups__checkbox",type:"checkbox",value:"group.id","onUpdate:modelValue":d=>r.selected=d},null,8,oe),[[E,r.selected]]),l("b",null,h(r.name),1),b(" ("+h(e.formatTime(r.seconds))+") ",1)]),l("div",ie,[(c(!0),u(y,null,S(r.tasks,d=>(c(),u("div",{class:"groups__task",key:d.id},[f(n,{fields:d},null,8,["fields"])]))),128))])]))),128))])):g("",!0),o.resultExist?(c(),u("div",le,[l("div",de," \u0421\u0443\u043C\u043C\u0430 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445: "+h(e.formatTime(e.checkedSumm)),1),l("div",ce," \u0412\u0441\u0435\u0433\u043E \u0437\u0430\u0442\u0440\u0430\u0447\u0435\u043D\u043E: "+h(e.formatTime(e.totalSumm)),1)])):g("",!0),o.resultExist?g("",!0):(c(),u("div",ue,"\u0414\u0430\u043D\u043D\u044B\u0445 \u043D\u0435\u0442"))])}var he=p(se,[["render",_e]]);const pe={name:"App",components:{Header:w,Settings:q,Groups:he}};function ge(t,s,a,i,o,e){const n=m("Header"),r=m("Settings"),d=m("Groups");return c(),u("div",{class:x(["weekly",{"is-loading":this.$store.state.isLoading}])},[f(n),f(r),f(d)],2)}var me=p(pe,[["render",ge]]);const I=new Date;let fe=new Date(I-(I.getDay()-1)*864e5),Ie=new Date(I-(I.getDay()-1)*864e5+6*864e5);var De=A({state(){return{apiUrl:localStorage.getItem("apiUrl")||"",userId:localStorage.getItem("userId")||"",dateFrom:fe,dateTo:Ie,isLoading:!0}},mutations:{apiChange(t,s){t.apiUrl=s.apiUrl,localStorage.setItem("apiUrl",s.apiUrl)},userChange(t,s){t.userId=s.userId,localStorage.setItem("userId",s.userId)},dateChange(t,s){t.dateFrom=s.dateFrom,t.dateTo=s.dateTo},loadingChange(t,s){t.isLoading=s.isLoading}}});U(me).use(De).mount("#app");
