import{o as c,c as u,a as l,A as $,w as D,v,t as h,r as m,b as g,F as y,d as S,e as E,f as b,g as f,n as x,h as A,i as U}from"./vendor.c5d43746.js";const C=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerpolicy&&(t.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?t.credentials="include":o.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(o){if(o.ep)return;o.ep=!0;const t=n(o);fetch(o.href,t)}};C();var p=(e,r)=>{const n=e.__vccOpts||e;for(const[i,o]of r)n[i]=o;return n};const O={name:"Header"},L={class:"header"},F=l("h1",{class:"header__h1"},'\u041E\u0442\u0447\u0435\u0442 "\u041D\u0435\u0434\u0435\u043B\u044C\u043A\u0430"',-1),j=[F];function N(e,r,n,i,o,t){return c(),u("header",L,j)}var w=p(O,[["render",N]]);const P={name:"Settings",data(){return{apiUrl:this.$store.state.apiUrl,userId:this.$store.state.userId,start:this.$store.state.dateFrom,end:this.$store.state.dateTo,datePickerInst:!1}},mounted(){this.datePickerInst=new $("[name=dates]",{range:!0,multipleDatesSeparator:" - ",selectedDates:[this.start,this.end],onSelect(e){e.date.length==2&&e.datepicker.hide()}})},methods:{setSettings(){this.$store.commit("apiChange",{apiUrl:this.apiUrl}),this.$store.commit("userChange",{userId:this.userId}),this.$store.commit("dateChange",{dateFrom:this.datePickerInst.selectedDates[0],dateTo:this.datePickerInst.selectedDates[1]})}}},M={class:"settings"},R={class:"settings__items"},V={class:"settings__item"},G=l("label",{class:"settings__label"},"\u0421\u0442\u0440\u043E\u043A\u0430 API",-1),H={class:"settings__item"},K=l("label",{class:"settings__label"},"ID \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",-1),z=l("div",{class:"settings__item"},[l("label",{class:"settings__label"},"\u041F\u0435\u0440\u0438\u043E\u0434"),l("input",{class:"settings__input",type:"text",name:"dates"})],-1),B={class:"settings__item"};function J(e,r,n,i,o,t){return c(),u("div",M,[l("div",R,[l("div",V,[G,D(l("input",{class:"settings__input",type:"text","onUpdate:modelValue":r[0]||(r[0]=a=>o.apiUrl=a)},null,512),[[v,o.apiUrl]])]),l("div",H,[K,D(l("input",{class:"settings__input",type:"text","onUpdate:modelValue":r[1]||(r[1]=a=>o.userId=a)},null,512),[[v,o.userId]])]),z,l("div",B,[l("button",{class:"settings__btn",onClick:r[2]||(r[2]=(...a)=>t.setSettings&&t.setSettings(...a))},"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C")])])])}var q=p(P,[["render",J]]);const k=e=>{let r,n,i;return r=e.getDate(),r<10&&(r="0"+r),n=e.getMonth()+1,n<10&&(n="0"+n),i=e.getFullYear(),r+"."+n+"."+i},T=e=>{let r,n,i;return r=Math.floor(e/3600),n=Math.floor(e/60)-r*60,i=e%60,[r.toString().padStart(2,"0"),n.toString().padStart(2,"0"),i.toString().padStart(2,"0")].join(":")},Y=async(e,r)=>fetch(e+"/task.elapseditem.getlist",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:{ID:"asc"},filter:r,select:["ID","TASK_ID","SECONDS"],params:{NAV_PARAMS:{nPageSize:0}}})}).then(n=>n.json()),Q=async(e,r)=>{const n=(a,s,d)=>fetch(a+"/tasks.task.list",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:{ID:"asc"},filter:s,select:["ID","TITLE","GROUP_ID","TIME_ESTIMATE"],start:d})}).then(_=>_.json());let i=[],o=0,t=null;for(;t===null||o<t;){let a=n(e,r,o);if(t===null){let s=await a;t=parseInt(s.total)}i.push(a),o+=50}return Promise.all(i)},W=async(e,r)=>fetch(e+"/sonet_group.get",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({ORDER:{ID:"asc"},FILTER:r})}).then(n=>n.json());const X={name:"TaskItem",props:["fields"],methods:{formatTime:T}},Z={class:"task"};function ee(e,r,n,i,o,t){return c(),u("div",Z,h(n.fields.id)+" - "+h(n.fields.name)+" ("+h(t.formatTime(n.fields.seconds))+") ",1)}var te=p(X,[["render",ee]]);const se={name:"Tasks",components:{TaskItem:te},data(){return{result:{},resultExist:!1,isLoading:!0}},computed:{settings(){return{apiUrl:this.$store.state.apiUrl,userId:this.$store.state.userId,dateFrom:this.$store.state.dateFrom,dateTo:this.$store.state.dateTo}},checkedSumm(){let e=0;for(const[r,n]of Object.entries(this.result))n.selected===!0&&(e+=n.seconds);return e},totalSumm(){let e=0;for(const[r,n]of Object.entries(this.result))e+=n.seconds;return e}},watch:{settings:{handler(){this.getData()},deep:!0}},created(){this.getData()},methods:{formatDate:k,formatTime:T,getData(){this.setLoadingStart();let e={},r={},n={},i={};if(!this.$store.state.userId||!this.$store.state.dateFrom||!this.$store.state.dateTo)return this.setLoadingEnd(),!1;let o={USER_ID:this.$store.state.userId,">=CREATED_DATE":k(this.$store.state.dateFrom),"<=CREATED_DATE":k(this.$store.state.dateTo)};Y(this.$store.state.apiUrl,o).then(t=>{if(t!=null)return t.result}).then(t=>{if(t!=null&&t.length){let a={ID:[]};return t.forEach(s=>{a.ID[a.ID.length]=s.TASK_ID,r[s.ID]={id:s.ID,taskId:s.TASK_ID,seconds:parseFloat(s.SECONDS)}}),a.ID=a.ID.filter((s,d,_)=>_.indexOf(s)===d),Q(this.$store.state.apiUrl,a)}}).then(t=>{if(t!=null){let a=[];return t.forEach(s=>{s!=null&&(a=a.concat(s.result.tasks))}),a}}).then(t=>{if(t!=null&&t.length){let a={ID:[]};return t.forEach(s=>{a.ID[a.ID.length]=s.groupId,n[s.id]={id:s.id,name:s.title,groupId:s.groupId,seconds:0}}),a.ID=a.ID.filter((s,d,_)=>_.indexOf(s)===d),W(this.$store.state.apiUrl,a)}}).then(t=>{if(t!=null)return t.result}).then(t=>{t!=null&&t.length&&t.forEach(a=>{i[a.ID]={id:a.ID,name:a.NAME,tasks:{},seconds:0,selected:this.result[a.ID]?this.result[a.ID].selected:!1}})}).then(t=>{e[0]={id:0,name:"\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u043A \u0433\u0440\u0443\u043F\u043F\u0435",tasks:{},seconds:0,selected:this.result[0]?this.result[0].selected:!1};for(const[a,s]of Object.entries(i))e[s.id]=s;for(const[a,s]of Object.entries(n)){let d=e[s.groupId]?e[s.groupId].id:0;e[d].tasks[s.id]=s,n[a].groupId=d}for(const[a,s]of Object.entries(r)){n[s.taskId]||(n[s.taskId]={id:s.taskId,name:"\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u043A \u0437\u0430\u0434\u0430\u0447\u0435 \u0438\u043B\u0438 \u0437\u0430\u0434\u0430\u0447\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0430",groupId:0,seconds:0},e[0].tasks[s.taskId]={id:s.taskId,name:"\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u043A \u0437\u0430\u0434\u0430\u0447\u0435 \u0438\u043B\u0438 \u0437\u0430\u0434\u0430\u0447\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0430",groupId:0,seconds:0});try{let d=n[s.taskId].groupId,_=s.taskId;e[d].seconds+=s.seconds,e[d].tasks[_].seconds+=s.seconds}catch(d){alert(d),console.log(s)}}Object.keys(e[0].tasks).length==0&&delete e[0],this.result=e,this.resultExist=Object.keys(e).length,this.setLoadingEnd()})},setLoadingStart(){this.$store.commit("loadingChange",{isLoading:!0})},setLoadingEnd(){this.$store.commit("loadingChange",{isLoading:!1})}}},re={class:"groups"},ae={key:1,class:"groups__items"},ne={class:"groups__label"},oe=["onUpdate:modelValue"],ie={class:"groups__tasks"},de={key:2,class:"groups__footer"},le={class:"groups__checked"},ce={class:"groups__total"},ue={key:3,class:"groups__empty"};function _e(e,r,n,i,o,t){const a=m("TaskItem");return c(),u("div",re,[o.resultExist?(c(),u("div",{key:0,class:"groups__refresh",onClick:r[0]||(r[0]=(...s)=>t.getData&&t.getData(...s))}," \u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435 ")):g("",!0),o.resultExist?(c(),u("div",ae,[(c(!0),u(y,null,S(o.result,s=>(c(),u("div",{class:"groups__item",key:s.id},[l("label",ne,[D(l("input",{class:"groups__checkbox",type:"checkbox",value:"group.id","onUpdate:modelValue":d=>s.selected=d},null,8,oe),[[E,s.selected]]),l("b",null,h(s.name),1),b(" ("+h(t.formatTime(s.seconds))+") ",1)]),l("div",ie,[(c(!0),u(y,null,S(s.tasks,d=>(c(),u("div",{class:"groups__task",key:d.id},[f(a,{fields:d},null,8,["fields"])]))),128))])]))),128))])):g("",!0),o.resultExist?(c(),u("div",de,[l("div",le," \u0421\u0443\u043C\u043C\u0430 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445: "+h(t.formatTime(t.checkedSumm)),1),l("div",ce," \u0412\u0441\u0435\u0433\u043E \u0437\u0430\u0442\u0440\u0430\u0447\u0435\u043D\u043E: "+h(t.formatTime(t.totalSumm)),1)])):g("",!0),o.resultExist?g("",!0):(c(),u("div",ue,"\u0414\u0430\u043D\u043D\u044B\u0445 \u043D\u0435\u0442"))])}var he=p(se,[["render",_e]]);const pe={name:"App",components:{Header:w,Settings:q,Groups:he}};function ge(e,r,n,i,o,t){const a=m("Header"),s=m("Settings"),d=m("Groups");return c(),u("div",{class:x(["weekly",{"is-loading":this.$store.state.isLoading}])},[f(a),f(s),f(d)],2)}var me=p(pe,[["render",ge]]);const I=new Date;let fe=new Date(I-(I.getDay()-1)*864e5),Ie=new Date(I-(I.getDay()-1)*864e5+6*864e5);var ke=A({state(){return{apiUrl:localStorage.getItem("apiUrl")||"",userId:localStorage.getItem("userId")||"",dateFrom:fe,dateTo:Ie,isLoading:!0}},mutations:{apiChange(e,r){e.apiUrl=r.apiUrl,localStorage.setItem("apiUrl",r.apiUrl)},userChange(e,r){e.userId=r.userId,localStorage.setItem("userId",r.userId)},dateChange(e,r){e.dateFrom=r.dateFrom,e.dateTo=r.dateTo},loadingChange(e,r){e.isLoading=r.isLoading}}});U(me).use(ke).mount("#app");
