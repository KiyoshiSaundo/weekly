import{o as c,c as u,a as l,A as $,w as y,v as D,t as _,r as h,F as k,b as T,d as I,e as C,f as b,g as p,n as A,h as U,i as E}from"./vendor.46640480.js";const x=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const t of r)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const t={};return r.integrity&&(t.integrity=r.integrity),r.referrerpolicy&&(t.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?t.credentials="include":r.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(r){if(r.ep)return;r.ep=!0;const t=a(r);fetch(r.href,t)}};x();var m=(s,e)=>{const a=s.__vccOpts||s;for(const[n,r]of e)a[n]=r;return a};const L={},w={class:"header"},N=l("h1",{class:"header__h1"},'\u041E\u0442\u0447\u0435\u0442 "\u041D\u0435\u0434\u0435\u043B\u044C\u043A\u0430"',-1),O=[N];function R(s,e){return c(),u("header",w,O)}var F=m(L,[["render",R]]);const P={data(){return{apiUrl:this.$store.state.apiUrl,userId:this.$store.state.userId,start:this.$store.state.dateFrom,end:this.$store.state.dateTo,datePickerInst:!1}},mounted(){this.datePickerInst=new $("[name=dates]",{range:!0,multipleDatesSeparator:" - ",selectedDates:[this.start,this.end],onSelect(s){s.date.length==2&&s.datepicker.hide()}})},methods:{setSettings(){this.$store.commit("apiChange",{apiUrl:this.apiUrl}),this.$store.commit("userChange",{userId:this.userId}),this.$store.commit("dateChange",{dateFrom:this.datePickerInst.selectedDates[0],dateTo:this.datePickerInst.selectedDates[1]})}}},j={class:"settings"},V={class:"settings__items"},G={class:"settings__item"},M=l("label",{class:"settings__label"},"\u0421\u0442\u0440\u043E\u043A\u0430 API",-1),K={class:"settings__item"},H=l("label",{class:"settings__label"},"ID \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",-1),z=l("div",{class:"settings__item"},[l("label",{class:"settings__label"},"\u041F\u0435\u0440\u0438\u043E\u0434"),l("input",{class:"settings__input",type:"text",name:"dates"})],-1),B={class:"settings__item"};function J(s,e,a,n,r,t){return c(),u("div",j,[l("div",V,[l("div",G,[M,y(l("input",{class:"settings__input",type:"text","onUpdate:modelValue":e[0]||(e[0]=i=>r.apiUrl=i)},null,512),[[D,r.apiUrl]])]),l("div",K,[H,y(l("input",{class:"settings__input",type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>r.userId=i)},null,512),[[D,r.userId]])]),z,l("div",B,[l("button",{class:"settings__btn",onClick:e[2]||(e[2]=(...i)=>t.setSettings&&t.setSettings(...i))},"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C")])])])}var q=m(P,[["render",J]]);const v=s=>{let e,a,n;return e=s.getDate(),e<10&&(e="0"+e),a=s.getMonth()+1,a<10&&(a="0"+a),n=s.getFullYear(),e+"."+a+"."+n},S=s=>{let e,a,n;return e=Math.floor(s/3600),a=Math.floor(s/60)-e*60,n=s%60,[e.toString().padStart(2,"0"),a.toString().padStart(2,"0"),n.toString().padStart(2,"0")].join(":")},Y=async(s,e)=>fetch(s+"/task.elapseditem.getlist",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:{ID:"asc"},filter:e,select:["ID","TASK_ID","SECONDS"],params:{NAV_PARAMS:{nPageSize:0}}})}).then(a=>a.json()).then(a=>a.result),Q=async(s,e)=>{const a=(i,o,d)=>fetch(i+"/tasks.task.list",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:{ID:"asc"},filter:o,select:["ID","TITLE","GROUP_ID"],start:d})}).then(f=>f.json());let n=[],r=0,t=null;for(;t===null||r<t;){let i=a(s,e,r);if(t===null){let o=await i;t=parseInt(o.total)}n.push(i),r+=50}return Promise.all(n).then(i=>i.reduce((o,d)=>o.concat(d.result.tasks),[]))},W=async(s,e)=>fetch(s+"/sonet_group.get",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({ORDER:{ID:"asc"},FILTER:e})}).then(a=>a.json()).then(a=>a.result);const X={props:["fields"],methods:{formatTime:S}},Z={class:"task"};function ee(s,e,a,n,r,t){return c(),u("div",Z,_(a.fields.id)+" - "+_(a.fields.name)+" ("+_(t.formatTime(a.fields.seconds))+") ",1)}var te=m(X,[["render",ee]]);const se={components:{TaskItem:te},data(){return{result:[]}},computed:{settings(){return{apiUrl:this.$store.state.apiUrl,userId:this.$store.state.userId,dateFrom:this.$store.state.dateFrom,dateTo:this.$store.state.dateTo}},summChecked(){return this.result.reduce((s,e)=>s+=e.selected?e.seconds:0,0)},summTotal(){return this.result.reduce((s,e)=>s+=e.seconds,0)}},created(){this.getResult()},watch:{settings(){this.getResult()},result(){this.setLoadingEnd()}},methods:{formatDate:v,formatTime:S,async getResult(){this.setLoadingStart();const[s,e,a]=await this.getResultData();let n={0:{id:0,name:"\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u043A \u0433\u0440\u0443\u043F\u043F\u0435",seconds:0,selected:this.result[0]?this.result[0].selected:!1,tasks:{0:{id:0,name:"\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u043A \u0437\u0430\u0434\u0430\u0447\u0435 \u0438\u043B\u0438 \u0437\u0430\u0434\u0430\u0447\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0430",seconds:0}}}};a.forEach(t=>{n[t.ID]={id:t.ID,name:t.NAME,seconds:0,selected:this.result[t.ID]?this.result[t.ID].selected:!1,tasks:{}}});let r={0:0};e.forEach(t=>{let i=n[t.groupId].id||0;r[t.id]=i,n[i].tasks[t.id]={id:t.id,name:t.title,seconds:0}}),s.forEach(t=>{let i=n[r[t.TASK_ID]],o=i?i.id:0,d=n[o].tasks[t.TASK_ID],f=d?d.id:0;n[o].seconds+=parseInt(t.SECONDS),n[o].tasks[f].seconds+=parseInt(t.SECONDS)}),this.result=Object.values(n).filter(t=>(t.tasks=Object.values(t.tasks).filter(i=>i.seconds),t.seconds))},async getResultData(){let s={USER_ID:this.$store.state.userId,">=CREATED_DATE":v(this.$store.state.dateFrom)+" 00:00:00","<=CREATED_DATE":v(this.$store.state.dateTo)+" 23:59:59"},e=await Y(this.$store.state.apiUrl,s),a=[];s={ID:e.map(r=>r.TASK_ID)},s.ID.length&&(a=await Q(this.$store.state.apiUrl,s));let n=[];return s={ID:a.map(r=>r.groupId)},s.ID.length&&(n=await W(this.$store.state.apiUrl,s)),[e,a,n]},setLoadingStart(){this.$store.commit("loadingChange",{isLoading:!0})},setLoadingEnd(){this.$store.commit("loadingChange",{isLoading:!1})}}},re={class:"groups"},ae={key:0,class:"groups__items"},ne={class:"groups__label"},ie=["onUpdate:modelValue"],oe={class:"groups__tasks"},le={key:1,class:"groups__footer"},de={class:"groups__checked"},ce={class:"groups__total"},ue={key:2,class:"groups__empty"};function _e(s,e,a,n,r,t){const i=h("TaskItem");return c(),u("div",re,[l("div",{class:"groups__refresh",onClick:e[0]||(e[0]=(...o)=>t.getResult&&t.getResult(...o))},"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435"),r.result.length?(c(),u("div",ae,[(c(!0),u(k,null,T(r.result,o=>(c(),u("div",{class:"groups__item",key:o.id},[l("label",ne,[y(l("input",{class:"groups__checkbox",type:"checkbox",value:"group.id","onUpdate:modelValue":d=>o.selected=d},null,8,ie),[[C,o.selected]]),l("b",null,_(o.name),1),b(" ("+_(t.formatTime(o.seconds))+") ",1)]),l("div",oe,[(c(!0),u(k,null,T(o.tasks,d=>(c(),u("div",{class:"groups__task",key:d.id},[p(i,{fields:d},null,8,["fields"])]))),128))])]))),128))])):I("",!0),r.result.length?(c(),u("div",le,[l("div",de,"\u0421\u0443\u043C\u043C\u0430 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445: "+_(t.formatTime(t.summChecked)),1),l("div",ce,"\u0412\u0441\u0435\u0433\u043E \u0437\u0430\u0442\u0440\u0430\u0447\u0435\u043D\u043E: "+_(t.formatTime(t.summTotal)),1)])):I("",!0),r.result.length?I("",!0):(c(),u("div",ue,"\u0414\u0430\u043D\u043D\u044B\u0445 \u043D\u0435\u0442"))])}var me=m(se,[["render",_e]]);const he={name:"App",components:{Header:F,Settings:q,Groups:me}};function pe(s,e,a,n,r,t){const i=h("Header"),o=h("Settings"),d=h("Groups");return c(),u("div",{class:A(["weekly",{"is-loading":this.$store.state.isLoading}])},[p(i),p(o),p(d)],2)}var ge=m(he,[["render",pe]]);const g=new Date;let fe=new Date(g-(g.getDay()-1)*864e5),Ie=new Date(g-(g.getDay()-1)*864e5+6*864e5);var ve=U({state(){return{apiUrl:localStorage.getItem("apiUrl")||"",userId:localStorage.getItem("userId")||"",dateFrom:fe,dateTo:Ie,isLoading:!1}},mutations:{apiChange(s,e){s.apiUrl=e.apiUrl,localStorage.setItem("apiUrl",e.apiUrl)},userChange(s,e){s.userId=e.userId,localStorage.setItem("userId",e.userId)},dateChange(s,e){s.dateFrom=e.dateFrom,s.dateTo=e.dateTo},loadingChange(s,e){s.isLoading=e.isLoading}}});E(ge).use(ve).mount("#app");
