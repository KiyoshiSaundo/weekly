import{o as c,c as u,a as l,A as $,w as D,v,t as _,r as m,F as y,b as k,d as f,e as C,f as b,g,n as w,h as U,i as A}from"./vendor.46640480.js";const E=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=a(r);fetch(r.href,s)}};E();var h=(t,e)=>{const a=t.__vccOpts||t;for(const[n,r]of e)a[n]=r;return a};const x={},F={class:"header"},L=l("h1",{class:"header__h1"},'\u041E\u0442\u0447\u0435\u0442 "\u041D\u0435\u0434\u0435\u043B\u044C\u043A\u0430"',-1),R=[L];function N(t,e){return c(),u("header",F,R)}var O=h(x,[["render",N]]);const I=t=>{let e,a,n;return e=t.getDate(),e<10&&(e="0"+e),a=t.getMonth()+1,a<10&&(a="0"+a),n=t.getFullYear(),e+"."+a+"."+n},T=t=>{let e,a,n;return e=Math.floor(t/3600),a=Math.floor(t/60)-e*60,n=t%60,[e.toString().padStart(2,"0"),a.toString().padStart(2,"0"),n.toString().padStart(2,"0")].join(":")},M=()=>{const t=new Date;return[t,t]},S=()=>{const t=new Date;let e=new Date(t-(t.getDay()-1)*864e5),a=new Date(t-(t.getDay()-1)*864e5+6*864e5);return[e,a]},P=()=>{const t=new Date;let e=new Date(t.getFullYear(),t.getMonth(),1),a=new Date(t.getFullYear(),t.getMonth()+1,0);return[e,a]};const V={data(){return{apiUrl:this.$store.state.apiUrl,userId:this.$store.state.userId,start:this.$store.state.dateFrom,end:this.$store.state.dateTo,datePickerInst:!1}},mounted(){let t={content:"\u0414\u0435\u043D\u044C",onClick:n=>{let r=M();n.selectDate(r),n.setViewDate(r[0])}},e={content:"\u041D\u0435\u0434\u0435\u043B\u044F",onClick:n=>{let r=S();n.selectDate(r),n.setViewDate(r[0])}},a={content:"\u041C\u0435\u0441\u044F\u0446",onClick:n=>{let r=P();n.selectDate(r),n.setViewDate(r[0])}};this.datePickerInst=new $("[name=dates]",{range:!0,multipleDatesSeparator:" - ",selectedDates:[this.start,this.end],buttons:[t,e,a],toggleSelected:!1,onSelect(n){n.date.length==2&&n.datepicker.hide()}})},methods:{setSettings(){this.$store.commit("apiChange",{apiUrl:this.apiUrl}),this.$store.commit("userChange",{userId:this.userId}),this.$store.commit("dateChange",{dateFrom:this.datePickerInst.selectedDates[0],dateTo:this.datePickerInst.selectedDates[1]||this.datePickerInst.selectedDates[0]})}}},j={class:"settings"},G={class:"settings__items"},K={class:"settings__item"},H=l("label",{class:"settings__label"},"\u0421\u0442\u0440\u043E\u043A\u0430 API",-1),z={class:"settings__item"},B=l("label",{class:"settings__label"},"ID \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",-1),J=l("div",{class:"settings__item"},[l("label",{class:"settings__label"},"\u041F\u0435\u0440\u0438\u043E\u0434"),l("input",{class:"settings__input",type:"text",name:"dates"})],-1),Y={class:"settings__item"};function W(t,e,a,n,r,s){return c(),u("div",j,[l("div",G,[l("div",K,[H,D(l("input",{class:"settings__input",type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>r.apiUrl=o)},null,512),[[v,r.apiUrl]])]),l("div",z,[B,D(l("input",{class:"settings__input",type:"text","onUpdate:modelValue":e[1]||(e[1]=o=>r.userId=o)},null,512),[[v,r.userId]])]),J,l("div",Y,[l("button",{class:"settings__btn",onClick:e[2]||(e[2]=(...o)=>s.setSettings&&s.setSettings(...o))},"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C")])])])}var q=h(V,[["render",W]]);const Q=async(t,e)=>fetch(t+"/task.elapseditem.getlist",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:{ID:"asc"},filter:e,select:["ID","TASK_ID","SECONDS"],params:{NAV_PARAMS:{nPageSize:0}}})}).then(a=>a.json()).then(a=>a.result),X=async(t,e)=>{const a=(o,i,d)=>fetch(o+"/tasks.task.list",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:{ID:"asc"},filter:i,select:["ID","TITLE","GROUP_ID"],start:d})}).then(p=>p.json());let n=[],r=0,s=null;for(;s===null||r<s;){let o=a(t,e,r);if(s===null){let i=await o;s=parseInt(i.total)}n.push(o),r+=50}return Promise.all(n).then(o=>o.reduce((i,d)=>i.concat(d.result.tasks),[]))},Z=async(t,e)=>fetch(t+"/sonet_group.get",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({ORDER:{ID:"asc"},FILTER:e})}).then(a=>a.json()).then(a=>a.result);const ee={props:["fields"],methods:{formatTime:T}},te={class:"task"};function se(t,e,a,n,r,s){return c(),u("div",te,_(a.fields.id)+" - "+_(a.fields.name)+" ("+_(s.formatTime(a.fields.seconds))+") ",1)}var re=h(ee,[["render",se]]);const ae={components:{TaskItem:re},data(){return{result:[]}},computed:{settings(){return{apiUrl:this.$store.state.apiUrl,userId:this.$store.state.userId,dateFrom:this.$store.state.dateFrom,dateTo:this.$store.state.dateTo}},summChecked(){return this.result.reduce((t,e)=>t+=e.selected?e.seconds:0,0)},summTotal(){return this.result.reduce((t,e)=>t+=e.seconds,0)}},created(){this.getResult()},watch:{settings(){this.getResult()},result(){this.setLoadingEnd()}},methods:{formatDate:I,formatTime:T,async getResult(){this.setLoadingStart();const[t,e,a]=await this.getResultData();let n={0:{id:0,name:"\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u043A \u0433\u0440\u0443\u043F\u043F\u0435",seconds:0,selected:this.result[0]?this.result[0].selected:!1,tasks:{0:{id:0,name:"\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u043A \u0437\u0430\u0434\u0430\u0447\u0435 \u0438\u043B\u0438 \u0437\u0430\u0434\u0430\u0447\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0430",seconds:0}}}};a.forEach(s=>{n[s.ID]={id:s.ID,name:s.NAME,seconds:0,selected:this.result[s.ID]?this.result[s.ID].selected:!1,tasks:{}}});let r={0:0};e.forEach(s=>{let o=n[s.groupId],i=o?o.id:0;r[s.id]=i,n[i].tasks[s.id]={id:s.id,name:s.title,seconds:0}}),t.forEach(s=>{let o=n[r[s.TASK_ID]],i=o?o.id:0,d=n[i].tasks[s.TASK_ID],p=d?d.id:0;n[i].seconds+=parseInt(s.SECONDS),n[i].tasks[p].seconds+=parseInt(s.SECONDS)}),this.result=Object.values(n).filter(s=>(s.tasks=Object.values(s.tasks).filter(o=>o.seconds),s.seconds))},async getResultData(){let t=[],e={USER_ID:this.$store.state.userId,">=CREATED_DATE":I(this.$store.state.dateFrom)+" 00:00:00","<=CREATED_DATE":I(this.$store.state.dateTo)+" 23:59:59"};e.USER_ID&&(t=await Q(this.$store.state.apiUrl,e));let a=[];e={ID:t.map(r=>r.TASK_ID)},e.ID.length&&(a=await X(this.$store.state.apiUrl,e));let n=[];return e={ID:a.map(r=>r.groupId)},e.ID.length&&(n=await Z(this.$store.state.apiUrl,e)),[t,a,n]},setLoadingStart(){this.$store.commit("loadingChange",{isLoading:!0})},setLoadingEnd(){this.$store.commit("loadingChange",{isLoading:!1})}}},ne={class:"groups"},oe={key:0,class:"groups__items"},ie={class:"groups__label"},le=["onUpdate:modelValue"],de={class:"groups__tasks"},ce={key:1,class:"groups__footer"},ue={class:"groups__checked"},_e={class:"groups__total"},he={key:2,class:"groups__empty"};function me(t,e,a,n,r,s){const o=m("TaskItem");return c(),u("div",ne,[l("div",{class:"groups__refresh",onClick:e[0]||(e[0]=(...i)=>s.getResult&&s.getResult(...i))},"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u044B\u0435"),r.result.length?(c(),u("div",oe,[(c(!0),u(y,null,k(r.result,i=>(c(),u("div",{class:"groups__item",key:i.id},[l("label",ie,[D(l("input",{class:"groups__checkbox",type:"checkbox",value:"group.id","onUpdate:modelValue":d=>i.selected=d},null,8,le),[[C,i.selected]]),l("b",null,_(i.name),1),b(" ("+_(s.formatTime(i.seconds))+") ",1)]),l("div",de,[(c(!0),u(y,null,k(i.tasks,d=>(c(),u("div",{class:"groups__task",key:d.id},[g(o,{fields:d},null,8,["fields"])]))),128))])]))),128))])):f("",!0),r.result.length?(c(),u("div",ce,[l("div",ue,"\u0421\u0443\u043C\u043C\u0430 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445: "+_(s.formatTime(s.summChecked)),1),l("div",_e,"\u0412\u0441\u0435\u0433\u043E \u0437\u0430\u0442\u0440\u0430\u0447\u0435\u043D\u043E: "+_(s.formatTime(s.summTotal)),1)])):f("",!0),r.result.length?f("",!0):(c(),u("div",he,"\u0414\u0430\u043D\u043D\u044B\u0445 \u043D\u0435\u0442"))])}var ge=h(ae,[["render",me]]);const pe={name:"App",components:{Header:O,Settings:q,Groups:ge}};function fe(t,e,a,n,r,s){const o=m("Header"),i=m("Settings"),d=m("Groups");return c(),u("div",{class:w(["weekly",{"is-loading":this.$store.state.isLoading}])},[g(o),g(i),g(d)],2)}var Ie=h(pe,[["render",fe]]);const[De,ve]=S();var ye=U({state(){return{apiUrl:localStorage.getItem("apiUrl")||"",userId:localStorage.getItem("userId")||"",dateFrom:De,dateTo:ve,isLoading:!1}},mutations:{apiChange(t,e){t.apiUrl=e.apiUrl,localStorage.setItem("apiUrl",e.apiUrl)},userChange(t,e){t.userId=e.userId,localStorage.setItem("userId",e.userId)},dateChange(t,e){t.dateFrom=e.dateFrom,t.dateTo=e.dateTo},loadingChange(t,e){t.isLoading=e.isLoading}}});A(Ie).use(ye).mount("#app");
